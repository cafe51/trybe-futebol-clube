# Boas vindas ao reposit√≥rio do projeto <b>Trybe Futebol Clube</b>!

Esse projeto foi desenvolvido durante o m√≥dulo de Backend na Trybe! #vqv 


---

# Habilidades desenvolvidas

Neste projeto, fui capaz de:

- Utilizar TypeScript;
- Utilizar os princ√≠pios do POO para criar uma estrutura de um campeonato de futebol;
- Utilizar os princ√≠pios da arquitetura SOLID para organizar o projeto e deix√°-lo com uma manutenibilidade muito maior;
- Construir um backend dockerizado utilizando modelagem de dados atrav√©s do ORM Sequelize;
- CRUD para cria√ß√£o, leitura, atualiza√ß√£o e/ou remo√ß√£o de usu√°rios, times, partidas e tabela (placar do campeonato);
- Organiza√ß√£o do c√≥digo respeitando tamb√©m o modelo MSC (Model-Service-Controller), de forma a dividir a responsabilidade do c√≥digo e das fun√ß√µes/m√©todos de acordo com suas propostas;
- Constru√ß√£o de testes de integra√ß√£o utilizando **Mocha**, **Chai** e **Sinon**.
   
---

# CRUD

CRUD √© um acr√¥nimo para **C**reate, **R**ead, **U**pdate and **D**elete. Em portugu√™s seria **Criar**, **Ler**, **Atualizar** e **Deletar** registros. Nesse projeto trabalhamos diretamente com a manipula√ß√£o no banco de dados MySQL, utilizando do ORM Sequelize para a manipula√ß√£o do banco.

---

# MSC

MSC √© um acr√¥nimo para **M**odel, **S**ervices e **C**ontroller. A utiliza√ß√£o dessas camadas facilita a manuten√ß√£o e legibilidade no c√≥digo, uma vez que cada camada √© respons√°vel por apenas uma fun√ß√£o. A camada Controller √© respons√°vel por retornar as requisi√ß√µes e respostas de nossa API para o usu√°rio, enquanto que a camada Model faz as queries necess√°rias diretamente ao banco de dados. J√° o Service √© respons√°vel por fazer a intermedia√ß√£o entre as duas camadas, podendo agir como regulador das regras de neg√≥cio da aplica√ß√£o e lan√ßar erros em caso de algum problema na requisi√ß√£o ou query.

---

# ORM

Os ORMs ou **O**bject-**R**elational **M**appers visam diminuir o uso dos comandos e consultas SQL nas tabelas do banco de dados. Utilizando um framework baseado em ORM, conseguimos utilizar comandos SQL sem utilizar a linguagem do mySQL para tal. Nesse projeto utilizamos o **Sequelize**.

---

# Sequelize

O Sequelize √© um ORM baseado em **Promises** para Node.js e pode ser utilizado para diversos bancos de dados. Neste projeto, utilizei em conjunto com o MySQL.

---

# POO

A Programa√ß√£o Orientada a Objetos (POO), um paradigma de programa√ß√£o, baseia-se na organiza√ß√£o de comportamentos e estados em objetos, que s√£o agrupados por suas semelhan√ßas em classes. Essas classes orientam o comportamento do objeto, definido por m√©todos e atributos. No projeto em quest√£o, consegui aplicar e solidificar minha compreens√£o dos quatro pilares fundamentais da POO: heran√ßa, polimorfismo, abstra√ß√£o e encapsulamento.

---

# SOLID

O SOLID √© um facilitador que torna o c√≥digo mais coeso, al√©m de mais f√°cil de manter, estender, adaptar e ajustar conforme altera√ß√µes de escopo. Al√©m disso, ele faz com que o c√≥digo seja test√°vel e de f√°cil entendimento, extens√≠vel e forne√ßa o m√°ximo de reaproveitamento. O termo SOLID √© um acr√¥nimo que representa cinco ideias e significam:

- Single Responsability Principle (Princ√≠pio da Responsabilidade √önica);
- Open/Closed Principle (Princ√≠pio Aberto/Fechado);
- Liskov Substitution Principle (Princ√≠pio da substitui√ß√£o de Liskov);
- Interface Segregation Principle (Princ√≠pio da Segrega√ß√£o de Interface);
- Dependency Inversion Principle (Princ√≠pio da Invers√£o de Depend√™ncia).

Para mais detalhes, sugiro acessar documenta√ß√µes oficiais.

---

# Funcionamento da aplica√ß√£o

Para rodar est√° aplica√ß√£o √© necess√°rio ter **Git**, **Docker**, **Node** e o **Docker Compose** instalados no seu computador. O Docker Compose precisa estar na vers√£o **1.29** ou superior e o Node na vers√£o **16**.

### 1 - Clone o reposit√≥rio e entre na pasta do projeto

```
git clone git@github.com:GJMKauer/trybe-futebol-clube.git && cd trybe-futebol-clube
```

### 2 - Execute o comando para cria√ß√£o dos containers do Docker

```
npm run compose:up
```

### 3 - Acesse a aplica√ß√£o no seu navegador pelo link

http://localhost:3000/

### 4 - Utilize uma das credenciais abaixo para logar na aplica√ß√£o e testar

#### Administrador

* email: admin@admin.com
* password: secret_admin

#### Usu√°rio comum

* email: user@user.com
* password: secret_user

O projeto trata-se de um desafio para consolidar todo o aprendizado at√© ent√£o em backend. Sendo o projeto mais desafiador da Trybe at√© o momento, tivemos que utilizar todos os conceitos ensinados e praticados desde ent√£o - utiliza√ß√£o de HOFs, CRUD, Sequelize, manipula√ß√£o do banco de dados, cria√ß√£o e valida√ß√£o de tokens JWT para login/cadastro de usu√°rios, valida√ß√£o/criptografia de senhas com o BCrypt e muito mais.

Com isso, o projeto trata-se de um sistema de gerenciamento de campeonato do *Trybe Futebol Clube* (vide nome do projeto). Nele, √© poss√≠vel realizar login como um usu√°rio comum ou como um administrador; visualizar partidas em andamento e j√° finalizadas; alterar o placar das partidas em andamento; finalizar partidas em andamento; adicionar novas partidas e visualizar o placar geral do campeonato.

A parte do frontend da aplica√ß√£o j√° veio pronta pela Trybe. No entanto, todo o Backend e valida√ß√µes foram realizadas por mim. Al√©m de tudo isso, implementei testes de integra√ß√£o que garantem o funcionamento do c√≥digo.

---

# Cobertura de testes da aplica√ß√£o

Execute o comando abaixo no diret√≥rio ra√≠z do projeto para verificar a cobertura de testes.

```
cd app/backend/ && npm install && npm run test:coverage
```

Constru√≠ a cobertura de pouco mais de 99% das fun√ß√µes do c√≥digo, por√©m no futuro pretendo atingir a cobertura da totalidade das linhas.

---

## üìö Documenta√ß√£o (endpoints)

### üîë Login
| M√©todo | Funcionalidade                          | URL                         |
| ------ | --------------------------------------- | --------------------------- |
| `POST` | Realiza o login no Backend da aplica√ß√£o | http://localhost:3001/login |

<details>
  <summary>A estrutura do <code>body</code> da requisi√ß√£o dever√° seguir o padr√£o abaixo:</summary>

```json
{
  "email": "admin@admin.com",
  "password": "secret_admin"
}
```

</details>

<details>
  <summary>A resposta da requisi√ß√£o √© a seguinte, com status 200:</summary>

```json
{
  "token": "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpZCI6MSwicm9sZSI6ImFkbWluIiwiaWF0IjoxNjU0NTI3MTg5fQ.XS_9AA82iNoiVaASi0NtJpqOQ_gHSHhxrpIdigiT-fc"
}
```

</details>

<details>
  <summary>A requisi√ß√£o ir√° falhar nos seguintes casos:</summary>
  - A rota retorna o c√≥digo <code>400</code>, com a mensagem <code>All fields must be filled</code> caso o campo email n√£o seja informado no body da requisi√ß√£o;<br>
  - A rota retorna o c√≥digo <code>400</code>, com a mensagem <code>All fields must be filled</code> caso o campo email n√£o seja informado no body da requisi√ß√£o;<br>
  - A rota retorna o c√≥digo <code>400</code>, com a mensagem <code>Incorrect email or password</code> caso o campo email seja inv√°lido no body da requisi√ß√£o;<br>
  - A rota retorna o c√≥digo <code>400</code>, com a mensagem <code>Incorrect email or password</code> caso o campo password seja inv√°lido no body da requisi√ß√£o;<br>
</details>
<br>
<br>

| M√©todo | Funcionalidade                         | URL                                  |
| ------ | -------------------------------------- | ------------------------------------ |
| `GET`  | Valida o login no Backend da aplica√ß√£o | http://localhost:3001/login/validate |

Essa requisi√ß√£o deve, obrigatoriamente, ter um `token de autentica√ß√£o` nos headers, no campo `authorization` (obtido ap√≥s realizar o login).

<details>
  <summary>A resposta da requisi√ß√£o √© a seguinte, com status 200:</summary>

```json
{ "role": "admin" }
```

</details>
<br>

### ü´Ç Teams
| M√©todo | Funcionalidade                          | URL                         |
| ------ | --------------------------------------- | --------------------------- |
| `GET`  | Retorna uma lista dos times cadastrados | http://localhost:3001/teams |

<details>
  <summary>A resposta da requisi√ß√£o √© a seguinte, com status 200:</summary>

```json
[
  {
    "id": 1,
    "teamName": "Ava√≠/Kindermann"
  },
  {
    "id": 2,
    "teamName": "Bahia"
  },
  {
    "id": 3,
    "teamName": "Botafogo"
  },
  // ...
]
```

</details>
<br>
<br>

| M√©todo | Funcionalidade                                                    | URL                             |
| ------ | ----------------------------------------------------------------- | ------------------------------- |
| `GET`  | Retorna um time no banco de dados (substitua `:id` por um n√∫mero) | http://localhost:3001/teams/:id |

<details>
  <summary>A resposta da requisi√ß√£o √© a seguinte, com status 200:</summary>

```json
[
  {
    "id": 1,
    "teamName": "Ava√≠/Kindermann"
  },
  {
    "id": 2,
    "teamName": "Bahia"
  },
  {
    "id": 3,
    "teamName": "Botafogo"
  },
  // ...
]
```

</details>
<br>

### ‚öΩ Matches
| M√©todo | Funcionalidade                             | URL                           |
| ------ | ------------------------------------------ | ----------------------------- |
| `GET`  | Retorna uma lista das partidas cadastradas | http://localhost:3001/matches |

<details>
  <summary>A resposta da requisi√ß√£o √© a seguinte, com status 200:</summary>

```json
[
  {
    "id": 1,
    "homeTeam": 16,
    "homeTeamGoals": 1,
    "awayTeam": 8,
    "awayTeamGoals": 1,
    "inProgress": false,
    "teamHome": {
      "teamName": "S√£o Paulo"
    },
    "teamAway": {
      "teamName": "Gr√™mio"
    }
  },
  // ...
  {
    "id": 41,
    "homeTeam": 16,
    "homeTeamGoals": 2,
    "awayTeam": 9,
    "awayTeamGoals": 0,
    "inProgress": true,
    "teamHome": {
      "teamName": "S√£o Paulo"
    },
    "teamAway": {
      "teamName": "Internacional"
    }
  }
]
```

</details>
<br>
<br>

| M√©todo | Funcionalidade                              | URL                                           |
| ------ | ------------------------------------------- | --------------------------------------------- |
| `GET`  | Retorna uma lista das partidas em andamento | http://localhost:3001/matches?inProgress=true |

<details>
  <summary>A resposta da requisi√ß√£o √© a seguinte, com status 200:</summary>

```json
[
  {
    "id": 41,
    "homeTeam": 16,
    "homeTeamGoals": 2,
    "awayTeam": 9,
    "awayTeamGoals": 0,
    "inProgress": true,
    "teamHome": {
      "teamName": "S√£o Paulo"
    },
    "teamAway": {
      "teamName": "Internacional"
    }
  },
  {
    "id": 42,
    "homeTeam": 6,
    "homeTeamGoals": 1,
    "awayTeam": 1,
    "awayTeamGoals": 0,
    "inProgress": true,
    "teamHome": {
      "teamName": "Ferrovi√°ria"
    },
    "teamAway": {
      "teamName": "Ava√≠/Kindermann"
    }
  }
]
```

</details>
<br>
<br>

| M√©todo | Funcionalidade                             | URL                                            |
| ------ | ------------------------------------------ | ---------------------------------------------- |
| `GET`  | Retorna uma lista das partidas finalizadas | http://localhost:3001/matches?inProgress=false |

<details>
  <summary>A resposta da requisi√ß√£o √© a seguinte, com status 200:</summary>

```json
[
  {
    "id": 1,
    "homeTeam": 16,
    "homeTeamGoals": 1,
    "awayTeam": 8,
    "awayTeamGoals": 1,
    "inProgress": false,
    "teamHome": {
      "teamName": "S√£o Paulo"
    },
    "teamAway": {
      "teamName": "Gr√™mio"
    }
  },
  {
    "id": 2,
    "homeTeam": 9,
    "homeTeamGoals": 1,
    "awayTeam": 14,
    "awayTeamGoals": 1,
    "inProgress": false,
    "teamHome": {
      "teamName": "Internacional"
    },
    "teamAway": {
      "teamName": "Santos"
    }
  }
]
```

</details>
<br>
<br>

| M√©todo | Funcionalidade                                      | URL                           |
| ------ | --------------------------------------------------- | ----------------------------- |
| `POST` | Adiciona uma partida em andamento ao banco de dados | http://localhost:3001/matches |

Essa requisi√ß√£o deve, obrigatoriamente, ter um `token de autentica√ß√£o` nos headers, no campo `authorization` (obtido ap√≥s realizar o login).

<details>
  <summary>A estrutura do <code>body</code> da requisi√ß√£o dever√° seguir o padr√£o abaixo:</summary>

```json
{
  "homeTeam": 16, // O valor deve ser o id do time
  "awayTeam": 8, // O valor deve ser o id do time
  "homeTeamGoals": 2,
  "awayTeamGoals": 2,
  "inProgress": true 
}
```

</details>

<details>
  <summary>A resposta da requisi√ß√£o √© a seguinte, com status 201:</summary>

```json
{
  "id": 1,
  "homeTeam": 16,
  "homeTeamGoals": 2,
  "awayTeam": 8,
  "awayTeamGoals": 2,
  "inProgress": true,
}
```

</details>

<details>
  <summary>A requisi√ß√£o ir√° falhar nos seguintes casos:</summary>
  - A rota retorna o c√≥digo <code>401</code>, com a mensagem <code>It is not possible to create a match with two equal teams</code> caso informe o mesmo valor para ambos os campos homeTeam e awayTeam body da requisi√ß√£o;<br>
  - A rota retorna o c√≥digo <code>404</code>, com a mensagem <code>There is no team with such id!</code> caso informe um id de time inv√°lido no body da requisi√ß√£o;<br>
  - A rota retorna o c√≥digo <code>401</code>, com a mensagem <code>Token must be a valid token</code> caso informe um token de autentica√ß√£o inv√°lido no campo authorization dos headers da requisi√ß√£o;<br>
</details>

<br>
<br>

| M√©todo  | Funcionalidade                                                            | URL                                      |
| ------- | ------------------------------------------------------------------------- | ---------------------------------------- |
| `PATCH` | Finaliza uma partida que est√° em andamento (substitua `id` por um n√∫mero) | http://localhost:3001/matches/:id/finish |

<details>
  <summary>A resposta da requisi√ß√£o √© a seguinte, com status 200:</summary>

```json
{ "message": "Finished" }
```

</details>
<br>
<br>

| M√©todo  | Funcionalidade                                                                               | URL                               |
| ------- | -------------------------------------------------------------------------------------------- | --------------------------------- |
| `PATCH` | Altera os dados de uma partida em andamento no banco de dados (substitua `id` por um n√∫mero) | http://localhost:3001/matches/:id |

<details>
  <summary>A estrutura do <code>body</code> da requisi√ß√£o dever√° seguir o padr√£o abaixo:</summary>

```json
{
  "homeTeamGoals": 3,
  "awayTeamGoals": 1
}
```

</details>

<details>
  <summary>A resposta da requisi√ß√£o √© a seguinte, com status 200:</summary>

```json
{
  "id": 1,
  "homeTeam": 16,
  "homeTeamGoals": 3,
  "awayTeam": 8,
  "awayTeamGoals": 1,
  "inProgress": true,
}
```

</details>
<br>

### üèÜ Leaderboards
| M√©todo | Funcionalidade                                 | URL                               |
| ------ | ---------------------------------------------- | --------------------------------- |
| `GET`  | Retorna o placar geral do campeonato, ordenado | http://localhost:3001/leaderboard |

<details>
  <summary>A resposta da requisi√ß√£o √© a seguinte, com status 200:</summary>

```json
[
  {
    "name": "Palmeiras",
    "totalPoints": 13,
    "totalGames": 5,
    "totalVictories": 4,
    "totalDraws": 1,
    "totalLosses": 0,
    "goalsFavor": 17,
    "goalsOwn": 5,
    "goalsBalance": 12,
    "efficiency": "86.67"
  },
  // ...
  {
    "name": "Napoli-SC",
    "totalPoints": 2,
    "totalGames": 5,
    "totalVictories": 0,
    "totalDraws": 2,
    "totalLosses": 3,
    "goalsFavor": 3,
    "goalsOwn": 12,
    "goalsBalance": -9,
    "efficiency": "13.33"
  }
]
```

</details>
<br>
<br>

| M√©todo | Funcionalidade                                               | URL                                    |
| ------ | ------------------------------------------------------------ | -------------------------------------- |
| `GET`  | Retorna o placar dos `jogos da casa` do campeonato, ordenado | http://localhost:3001/leaderboard/home |

<details>
  <summary>A resposta da requisi√ß√£o √© a seguinte, com status 200:</summary>

```json
[
  {
    "name": "Santos",
    "totalPoints": 9,
    "totalGames": 3,
    "totalVictories": 3,
    "totalDraws": 0,
    "totalLosses": 0,
    "goalsFavor": 9,
    "goalsOwn": 3,
    "goalsBalance": 6,
    "efficiency": "100.00"
  },
  // ...
  {
    "name": "Bahia",
    "totalPoints": 0,
    "totalGames": 3,
    "totalVictories": 0,
    "totalDraws": 0,
    "totalLosses": 3,
    "goalsFavor": 0,
    "goalsOwn": 4,
    "goalsBalance": -4,
    "efficiency": "0.00"
  }
]
```

</details>
<br>
<br>

| M√©todo | Funcionalidade                                                    | URL                                    |
| ------ | ----------------------------------------------------------------- | -------------------------------------- |
| `GET`  | Retorna o placar dos `jogos fora de casa` do campeonato, ordenado | http://localhost:3001/leaderboard/away |

<details>
  <summary>A resposta da requisi√ß√£o √© a seguinte, com status 200:</summary>

```json
[
  {
    "name": "Palmeiras",
    "totalPoints": 6,
    "totalGames": 2,
    "totalVictories": 2,
    "totalDraws": 0,
    "totalLosses": 0,
    "goalsFavor": 7,
    "goalsOwn": 0,
    "goalsBalance": 7,
    "efficiency": "100.00"
  },
  // ...
  {
    "name": "Napoli-SC",
    "totalPoints": 0,
    "totalGames": 3,
    "totalVictories": 0,
    "totalDraws": 0,
    "totalLosses": 3,
    "goalsFavor": 1,
    "goalsOwn": 10,
    "goalsBalance": -9,
    "efficiency": "0.00"
  }
]
```

</details>

---